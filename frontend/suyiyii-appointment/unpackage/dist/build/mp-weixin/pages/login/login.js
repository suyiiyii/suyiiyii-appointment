"use strict";const e=require("../../common/vendor.js"),o=require("../../config.js"),s=require("../../common/assets.js"),n={components:{tuiLoading:()=>"../../uni_modules/thorui/tui-loading/tui-loading.js"},data:()=>({username:"",password:"",failmsg:"",token:"",loading:!1}),methods:{redirect(){e.index.switchTab({url:"/pages/index/index"})},login(s,n){if(""==s||""==n)return this.failmsg="请输入用户名和密码",void this.$refs.input_empty_popup.open("top");let t=`${o.BASE_URL}/users/login`,i={username:s,password:n};this.loading=!0,e.index.request({url:t,method:"POST",dataType:"json",data:i,success:o=>{console.log(o),200==o.statusCode?(e.index.setStorage({key:"token",data:o.data.token.access_token}),this.redirect()):(this.failmsg=`登录失败：${o.data.detail}`,this.$refs.loginfail_popup.open("top"))},fail:e=>{console.log("ERROR"),console.log(e),this.failmsg=e.errMsg,this.$refs.loginfail_popup.open("top")}}),this.loading=!1},check_token(){e.index.getStorage({key:"token",success:({data:e})=>{this.token=e,console.log(e),this.redirect()},fail:e=>{this.token=""}})}},onLoad(){this.check_token(),""!=this.token&&this.redirect()}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uv-button")+e.resolveComponent("uni-popup-message")+e.resolveComponent("uni-popup")+e.resolveComponent("tui-loading"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uv-button/components/uv-button/uv-button.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-message/uni-popup-message.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/thorui/tui-loading/tui-loading.js"))();const t=e._export_sfc(n,[["render",function(o,n,t,i,p,a){return e.e({a:s._imports_0,b:e.o((e=>p.username=e)),c:e.p({placeholder:"username",modelValue:p.username}),d:e.o((e=>p.password=e)),e:e.p({placeholder:"passowrd",type:"password",passwordIcon:!0,modelValue:p.password}),f:e.o((e=>{a.login(p.username,p.password)})),g:e.p({type:"primary",disabled:p.loading}),h:e.o((e=>this.$refs.loginfail_popup.open("top"))),i:e.p({type:"error",message:p.failmsg,duration:2e3}),j:e.sr("loginfail_popup","e3505e88-4"),k:e.p({type:"message"}),l:e.p({type:"warn",message:p.failmsg,duration:2e3}),m:e.sr("input_empty_popup","e3505e88-6"),n:e.p({type:"message"}),o:p.loading},(p.loading,{}))}]]);wx.createPage(t);
